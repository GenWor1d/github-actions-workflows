# 通用Docker Compose配置 - 优雅变量管理
# 环境变量由.setup-env.yml统一生成到.env文件
services:
  app:
    # 构建配置
    build:
      # 构建上下文路径，指向项目根目录
      context: ..
      # Dockerfile文件路径，相对于context路径
      dockerfile: deployment/Dockerfile
      # 构建参数：从.env文件读取
      args:
        BRANCH_NAME: ${BRANCH_NAME:-dev}
        BUILD_TARGET: ${BUILD_TARGET:-h5}
    
    # 镜像名称和标签 - 直接使用.env中的变量
    image: ${PROJECT_NAME}:${IMAGE_TAG}
    container_name: ${CONTAINER_NAME}
    
    # 重启策略：除非手动停止，否则总是重启容器
    restart: unless-stopped
    
    # 端口映射
    ports:
      - "8080:80"
    
    # 网络配置：加入指定的网络
    networks:
      - app_network

# 网络定义
networks:
  app_network:
    external: true
    name: ${NETWORK_NAME}