name: 执行自定义预部署任务
on:
  workflow_call:
    inputs:
      branch:
        required: false
        type: string
        default: ${{ github.ref_name }}
      working-directory:
        required: false
        type: string
        default: 'deployment'

jobs:
  pre-deploy:
    runs-on: ${{ github.ref_name }}
    steps:
      - name: 检出代码
        uses: actions/checkout@v3
        with:
          ref: ${{ inputs.branch }}
          fetch-depth: 1
      
      - name: 执行预部署脚本
        run: |
          # 加载环境变量
          echo "[DEBUG] 加载环境变量..."
          source "$GITHUB_WORKSPACE/.env" || (echo "错误: 环境变量加载失败"; exit 1)
          echo "[DEBUG] 环境变量加载成功"
          
          # 先检查脚本文件是否存在
          if [ -f "./deployment/scripts/pre-deploy.sh" ]; then
            echo "找到预部署脚本文件"
            chmod +x ./deployment/scripts/pre-deploy.sh
            ./deployment/scripts/pre-deploy.sh
          else
            echo "错误：预部署脚本文件不存在"
            ls -la ./deployment/scripts/
            exit 1
          finame: 自定义预部署任务